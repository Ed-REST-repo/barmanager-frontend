<h2 mat-dialog-title>
  <mat-icon>add_circle</mat-icon>
  Reponer Stock
</h2>

<mat-dialog-content>
  
  <!-- Info del insumo -->
  <div class="insumo-info">
    <div class="info-header">
      <span class="icon">ðŸ“¦</span>
      <div>
        <h3>{{ insumo.nombre }}</h3>
        <p class="tipo">{{ insumo.tipo }}</p>
      </div>
    </div>

    <div class="info-stats">
      <div class="stat">
        <span class="label">Actual:</span>
        <span class="value">{{ insumo.cantidadDisponible }} {{ insumo.unidad?.abreviatura }}</span>
      </div>
      <div class="stat">
        <span class="label">MÃ­nimo:</span>
        <span class="value">{{ insumo.cantidadMinima }} {{ insumo.unidad?.abreviatura }}</span>
      </div>
      <div class="stat">
        <span class="label">Precio Unit.:</span>
        <span class="value">${{ insumo.precio | number:'1.0-0' }}</span>
      </div>
    </div>
  </div>

  <!-- Formulario -->
  <form [formGroup]="reponerForm">
    <mat-form-field class="full-width" appearance="outline">
      <mat-label>Cantidad a Reponer</mat-label>
      <input matInput type="number" formControlName="cantidad" min="1">
      <span matSuffix>{{ insumo.unidad?.abreviatura }}</span>
      <mat-icon matPrefix>inventory</mat-icon>
      <mat-error *ngIf="reponerForm.get('cantidad')?.hasError('required')">
        La cantidad es requerida
      </mat-error>
      <mat-error *ngIf="reponerForm.get('cantidad')?.hasError('min')">
        La cantidad debe ser mayor a 0
      </mat-error>
    </mat-form-field>

    <!-- Botones rÃ¡pidos -->
    <div class="quick-actions">
      <button mat-stroked-button type="button" (click)="setearHastaMinimo()">
        Hasta MÃ­nimo
      </button>
      <button mat-stroked-button type="button" (click)="setearCantidadSugerida()">
        Cantidad Sugerida
      </button>
    </div>
  </form>

  <!-- Preview del resultado -->
  <div class="preview" *ngIf="reponerForm.value.cantidad > 0">
    <h4>Resumen</h4>
    <div class="preview-items">
      <div class="preview-item">
        <mat-icon>trending_up</mat-icon>
        <div>
          <p class="preview-label">Nuevo Total</p>
          <p class="preview-value">{{ getNuevoTotal() }} {{ insumo.unidad?.abreviatura }}</p>
        </div>
      </div>
      <div class="preview-item">
        <mat-icon>attach_money</mat-icon>
        <div>
          <p class="preview-label">Costo Total</p>
          <p class="preview-value">${{ getCostoTotal() | number:'1.0-0' }}</p>
        </div>
      </div>
    </div>

    <!-- Barra de progreso simulada -->
    <div class="progress-preview">
      <p class="progress-label">Nivel de stock despuÃ©s de reponer:</p>
      <mat-progress-bar 
        mode="determinate" 
        [value]="(getNuevoTotal() / insumo.cantidadMinima) * 100"
        color="primary">
      </mat-progress-bar>
      <p class="progress-percentage">
        {{ (getNuevoTotal() / insumo.cantidadMinima) * 100 | number:'1.0-0' }}%
      </p>
    </div>
  </div>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancelar</button>
  <button mat-raised-button color="primary" 
          (click)="onConfirm()"
          [disabled]="reponerForm.invalid">
    <mat-icon>check</mat-icon>
    Confirmar ReposiciÃ³n
  </button>
</mat-dialog-actions>